<!DOCTYPE html>
<html>
<head>
    <title>Panorama - Московская</title>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="publish/style.css"/>
    <script src="lib/iscroll.js"></script>
    <script src="lib/jquery/jquery.min.js"></script>
    <style>
        #map_canvas {
            bottom: 20px;
            width: 478px;
            height: 388px;
            background: url("img/map2.png") no-repeat #ffffff;
        }
    </style>
</head>

<body>

<div class="map-canvas" id="map_canvas">
    <span style="bottom: 23px ; left: 417px;" data-map="pano_2-1-hq" class="map-canvas__point map-canvas__point_active"></span>
    <span  style="bottom: 78px ; left: 341px;" data-map="pano_2-2-hq" class="map-canvas__point"></span>
    <span  style="top: 60px ; left: 90px;" data-map="pano_2-3-hq" class="map-canvas__point"></span>
    <span  style="top: 50px ; left: 23px;" data-map="pano_2-4-hq" class="map-canvas__point"></span>
    <span  style="top: 220px ; left: 37px;" data-map="pano_2-5-hq" class="map-canvas__point"></span>
    <span  style="top: 130px ; left: 40px;" data-map="pano_2-6-hq" class="map-canvas__point"></span>
</div>
<div id="wrapper">
    <div id="scroller">
        <div class="pano pano_2-1-hq" id="pano">
        </div>
    </div>
</div>
<div class="b-navigation b-navigation_state_hide">

    <div class="b-navigation__control"></div>
    <a class="b-navigation__a" style="" href="mainhq.html">Развязка ул. Московская-Объездная</a>
    <a class="b-navigation__a b-navigation__a_active">Cтроющийся сектор ЕКАД</a>
</div>

<script>
    $(function () {

        var myScroll;
        var posX = -60000;
        var linearEasing = { style: 'linear', fn: function (k) {
            return k;
        } };


        myScroll = new IScroll('#wrapper', {
            // eventPassthrough: true,
            scrollX: true,
            scrollY: false,
            bounce: false,
            startX: posX
        });


        // scroll from side to side not leaving left and right borders
        function scrollPanorama() {
            var stepX = 0;
            var curPosX = myScroll.getComputedPosition().x;
            if (curPosX === posX) {
                if (curPosX > -30000) {
                    stepX = -10000;
                } else if (curPosX < -90000) {
                    stepX = 10000;
                } else {
                    stepX = -10000;
                }
                myScroll.scrollBy(stepX, 0, 100000, linearEasing);
            }
            posX = curPosX;
            setTimeout(scrollPanorama, 5000);
        }

        scrollPanorama();


        /*-точки---------------------------------------*/
        var $block = $('#map_canvas');
        var $points = $('.map-canvas__point',$block);
        var $pano = $('#pano');

        $points.on('click',function(e){
            $points.removeClass('map-canvas__point_active');
            var panoName = $(this).addClass('map-canvas__point_active').data('map');
            $pano[0].className = 'pano ' + panoName;
        });

        /*---------------------------------------*/

        $block = $('.b-navigation');
        $control = $('.b-navigation__control');

        $control.click(function (e) {
            if ($block.hasClass('b-navigation_state_hide')) {
                $block.animate({'right': "-0px"}, 300).removeClass('b-navigation_state_hide');
            } else {
                $block.animate({'right': "-340px"}, 300).addClass('b-navigation_state_hide');
            }
        });

    });
</script>
</body>
</html>